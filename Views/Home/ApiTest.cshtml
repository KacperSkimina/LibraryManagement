@{
    ViewData["Title"] = "Testowanie API";
}

<h1>Testowanie interfejsu API - Książki</h1>

<div class="row">
    <div class="col-md-6">
        <h3>Punkty końcowe (Endpoints)</h3>
        <ul>
            @* Linki otwierające surowe dane JSON bezpośrednio w przeglądarce *@
            <li><a href="/api/BooksApi" target="_blank">Pobierz wszystkie (GET /api/BooksApi)</a></li>
            <li><a href="/api/BooksApi/1" target="_blank">Pobierz jedną (GET /api/BooksApi/1)</a></li>
        </ul>

        <h3>Testowanie za pomocą JavaScript (Fetch)</h3>
        @* Przyciski wywołujące funkcje JS z sekcji Scripts *@
        <button onclick="getBooks()" class="btn btn-primary">Pobierz wszystkie książki</button>
        <button onclick="getBook(1)" class="btn btn-info">Pobierz książkę ID: 1</button>

        @* Miejsce, w którym JavaScript "wstrzyknie" otrzymane dane JSON *@
        <div id="result" class="mt-3" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 100px;">
            <p class="text-muted">Wyniki zapytania pojawią się tutaj...</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Funkcja pobierająca listę wszystkich książek asynchronicznie
        function getBooks() {
            fetch('/api/BooksApi') // Wysłanie żądania HTTP GET
                .then(response => response.json()) // Konwersja odpowiedzi na format JSON
                .then(data => {
                    // Wyświetlenie danych w elemencie 'result' w sformatowanym bloku <pre>
                    document.getElementById('result').innerHTML =
                        '<h5>Lista książek (JSON):</h5><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                })
                .catch(error => {
                    console.error('Błąd:', error);
                    document.getElementById('result').innerHTML = '<span class="text-danger">Błąd podczas pobierania danych.</span>';
                });
        }

        // Funkcja pobierająca konkretną książkę na podstawie przekazanego ID
        function getBook(id) {
            fetch(`/api/BooksApi/${id}`) // Wykorzystanie Template Literals do wstawienia ID w adres URL
                .then(response => {
                    if (!response.ok) throw new Error('Nie znaleziono książki');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('result').innerHTML =
                        '<h5>Szczegóły książki (JSON):</h5><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                })
                .catch(error => {
                    document.getElementById('result').innerHTML = '<span class="text-danger">Błąd: ' + error.message + '</span>';
                });
        }
    </script>
}